<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/lru-cache/test/basic.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/lru-cache/test/basic.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">65.73</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">396</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">77.52</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">4.57</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">var test = require(&quot;tap&quot;).test
  , LRU = require(&quot;../&quot;)

test(&quot;basic&quot;, function (t) {
  var cache = new LRU({max: 10})
  cache.set(&quot;key&quot;, &quot;value&quot;)
  t.equal(cache.get(&quot;key&quot;), &quot;value&quot;)
  t.equal(cache.get(&quot;nada&quot;), undefined)
  t.equal(cache.length, 1)
  t.equal(cache.max, 10)
  t.end()
})

test(&quot;least recently set&quot;, function (t) {
  var cache = new LRU(2)
  cache.set(&quot;a&quot;, &quot;A&quot;)
  cache.set(&quot;b&quot;, &quot;B&quot;)
  cache.set(&quot;c&quot;, &quot;C&quot;)
  t.equal(cache.get(&quot;c&quot;), &quot;C&quot;)
  t.equal(cache.get(&quot;b&quot;), &quot;B&quot;)
  t.equal(cache.get(&quot;a&quot;), undefined)
  t.end()
})

test(&quot;lru recently gotten&quot;, function (t) {
  var cache = new LRU(2)
  cache.set(&quot;a&quot;, &quot;A&quot;)
  cache.set(&quot;b&quot;, &quot;B&quot;)
  cache.get(&quot;a&quot;)
  cache.set(&quot;c&quot;, &quot;C&quot;)
  t.equal(cache.get(&quot;c&quot;), &quot;C&quot;)
  t.equal(cache.get(&quot;b&quot;), undefined)
  t.equal(cache.get(&quot;a&quot;), &quot;A&quot;)
  t.end()
})

test(&quot;del&quot;, function (t) {
  var cache = new LRU(2)
  cache.set(&quot;a&quot;, &quot;A&quot;)
  cache.del(&quot;a&quot;)
  t.equal(cache.get(&quot;a&quot;), undefined)
  t.end()
})

test(&quot;max&quot;, function (t) {
  var cache = new LRU(3)

  // test changing the max, verify that the LRU items get dropped.
  cache.max = 100
  for (var i = 0; i &lt; 100; i ++) cache.set(i, i)
  t.equal(cache.length, 100)
  for (var i = 0; i &lt; 100; i ++) {
    t.equal(cache.get(i), i)
  }
  cache.max = 3
  t.equal(cache.length, 3)
  for (var i = 0; i &lt; 97; i ++) {
    t.equal(cache.get(i), undefined)
  }
  for (var i = 98; i &lt; 100; i ++) {
    t.equal(cache.get(i), i)
  }

  // now remove the max restriction, and try again.
  cache.max = &quot;hello&quot;
  for (var i = 0; i &lt; 100; i ++) cache.set(i, i)
  t.equal(cache.length, 100)
  for (var i = 0; i &lt; 100; i ++) {
    t.equal(cache.get(i), i)
  }
  // should trigger an immediate resize
  cache.max = 3
  t.equal(cache.length, 3)
  for (var i = 0; i &lt; 97; i ++) {
    t.equal(cache.get(i), undefined)
  }
  for (var i = 98; i &lt; 100; i ++) {
    t.equal(cache.get(i), i)
  }
  t.end()
})

test(&quot;reset&quot;, function (t) {
  var cache = new LRU(10)
  cache.set(&quot;a&quot;, &quot;A&quot;)
  cache.set(&quot;b&quot;, &quot;B&quot;)
  cache.reset()
  t.equal(cache.length, 0)
  t.equal(cache.max, 10)
  t.equal(cache.get(&quot;a&quot;), undefined)
  t.equal(cache.get(&quot;b&quot;), undefined)
  t.end()
})


test(&quot;basic with weighed length&quot;, function (t) {
  var cache = new LRU({
    max: 100,
    length: function (item) { return item.size }
  })
  cache.set(&quot;key&quot;, {val: &quot;value&quot;, size: 50})
  t.equal(cache.get(&quot;key&quot;).val, &quot;value&quot;)
  t.equal(cache.get(&quot;nada&quot;), undefined)
  t.equal(cache.lengthCalculator(cache.get(&quot;key&quot;)), 50)
  t.equal(cache.length, 50)
  t.equal(cache.max, 100)
  t.end()
})


test(&quot;weighed length item too large&quot;, function (t) {
  var cache = new LRU({
    max: 10,
    length: function (item) { return item.size }
  })
  t.equal(cache.max, 10)

  // should fall out immediately
  cache.set(&quot;key&quot;, {val: &quot;value&quot;, size: 50})

  t.equal(cache.length, 0)
  t.equal(cache.get(&quot;key&quot;), undefined)
  t.end()
})

test(&quot;least recently set with weighed length&quot;, function (t) {
  var cache = new LRU({
    max:8,
    length: function (item) { return item.length }
  })
  cache.set(&quot;a&quot;, &quot;A&quot;)
  cache.set(&quot;b&quot;, &quot;BB&quot;)
  cache.set(&quot;c&quot;, &quot;CCC&quot;)
  cache.set(&quot;d&quot;, &quot;DDDD&quot;)
  t.equal(cache.get(&quot;d&quot;), &quot;DDDD&quot;)
  t.equal(cache.get(&quot;c&quot;), &quot;CCC&quot;)
  t.equal(cache.get(&quot;b&quot;), undefined)
  t.equal(cache.get(&quot;a&quot;), undefined)
  t.end()
})

test(&quot;lru recently gotten with weighed length&quot;, function (t) {
  var cache = new LRU({
    max: 8,
    length: function (item) { return item.length }
  })
  cache.set(&quot;a&quot;, &quot;A&quot;)
  cache.set(&quot;b&quot;, &quot;BB&quot;)
  cache.set(&quot;c&quot;, &quot;CCC&quot;)
  cache.get(&quot;a&quot;)
  cache.get(&quot;b&quot;)
  cache.set(&quot;d&quot;, &quot;DDDD&quot;)
  t.equal(cache.get(&quot;c&quot;), undefined)
  t.equal(cache.get(&quot;d&quot;), &quot;DDDD&quot;)
  t.equal(cache.get(&quot;b&quot;), &quot;BB&quot;)
  t.equal(cache.get(&quot;a&quot;), &quot;A&quot;)
  t.end()
})

test(&quot;lru recently updated with weighed length&quot;, function (t) {
  var cache = new LRU({
    max: 8,
    length: function (item) { return item.length }
  })
  cache.set(&quot;a&quot;, &quot;A&quot;)
  cache.set(&quot;b&quot;, &quot;BB&quot;)
  cache.set(&quot;c&quot;, &quot;CCC&quot;)
  t.equal(cache.length, 6) //CCC BB A
  cache.set(&quot;a&quot;, &quot;+A&quot;)
  t.equal(cache.length, 7) //+A CCC BB
  cache.set(&quot;b&quot;, &quot;++BB&quot;)
  t.equal(cache.length, 6) //++BB +A
  t.equal(cache.get(&quot;c&quot;), undefined)

  cache.set(&quot;c&quot;, &quot;oversized&quot;)
  t.equal(cache.length, 6) //++BB +A
  t.equal(cache.get(&quot;c&quot;), undefined)

  cache.set(&quot;a&quot;, &quot;oversized&quot;)
  t.equal(cache.length, 4) //++BB
  t.equal(cache.get(&quot;a&quot;), undefined)
  t.equal(cache.get(&quot;b&quot;), &quot;++BB&quot;)
  t.end()
})

test(&quot;set returns proper booleans&quot;, function(t) {
  var cache = new LRU({
    max: 5,
    length: function (item) { return item.length }
  })

  t.equal(cache.set(&quot;a&quot;, &quot;A&quot;), true)

  // should return false for max exceeded
  t.equal(cache.set(&quot;b&quot;, &quot;donuts&quot;), false)

  t.equal(cache.set(&quot;b&quot;, &quot;B&quot;), true)
  t.equal(cache.set(&quot;c&quot;, &quot;CCCC&quot;), true)
  t.end()
})

test(&quot;drop the old items&quot;, function(t) {
  var cache = new LRU({
    max: 5,
    maxAge: 50
  })

  cache.set(&quot;a&quot;, &quot;A&quot;)

  setTimeout(function () {
    cache.set(&quot;b&quot;, &quot;b&quot;)
    t.equal(cache.get(&quot;a&quot;), &quot;A&quot;)
  }, 25)

  setTimeout(function () {
    cache.set(&quot;c&quot;, &quot;C&quot;)
    // timed out
    t.notOk(cache.get(&quot;a&quot;))
  }, 60 + 25)

  setTimeout(function () {
    t.notOk(cache.get(&quot;b&quot;))
    t.equal(cache.get(&quot;c&quot;), &quot;C&quot;)
  }, 90)

  setTimeout(function () {
    t.notOk(cache.get(&quot;c&quot;))
    t.end()
  }, 155)
})

test(&quot;individual item can have it&#039;s own maxAge&quot;, function(t) {
  var cache = new LRU({
    max: 5,
    maxAge: 50
  })

  cache.set(&quot;a&quot;, &quot;A&quot;, 20)
  setTimeout(function () {
    t.notOk(cache.get(&quot;a&quot;))
    t.end()
  }, 25)
})

test(&quot;individual item can have it&#039;s own maxAge &gt; cache&#039;s&quot;, function(t) {
  var cache = new LRU({
    max: 5,
    maxAge: 20
  })

  cache.set(&quot;a&quot;, &quot;A&quot;, 50)
  setTimeout(function () {
    t.equal(cache.get(&quot;a&quot;), &quot;A&quot;)
    t.end()
  }, 25)
})

test(&quot;disposal function&quot;, function(t) {
  var disposed = false
  var cache = new LRU({
    max: 1,
    dispose: function (k, n) {
      disposed = n
    }
  })

  cache.set(1, 1)
  cache.set(2, 2)
  t.equal(disposed, 1)
  cache.set(3, 3)
  t.equal(disposed, 2)
  cache.reset()
  t.equal(disposed, 3)
  t.end()
})

test(&quot;disposal function on too big of item&quot;, function(t) {
  var disposed = false
  var cache = new LRU({
    max: 1,
    length: function (k) {
      return k.length
    },
    dispose: function (k, n) {
      disposed = n
    }
  })
  var obj = [ 1, 2 ]

  t.equal(disposed, false)
  cache.set(&quot;obj&quot;, obj)
  t.equal(disposed, obj)
  t.end()
})

test(&quot;has()&quot;, function(t) {
  var cache = new LRU({
    max: 1,
    maxAge: 10
  })

  cache.set(&#039;foo&#039;, &#039;bar&#039;)
  t.equal(cache.has(&#039;foo&#039;), true)
  cache.set(&#039;blu&#039;, &#039;baz&#039;)
  t.equal(cache.has(&#039;foo&#039;), false)
  t.equal(cache.has(&#039;blu&#039;), true)
  setTimeout(function() {
    t.equal(cache.has(&#039;blu&#039;), false)
    t.end()
  }, 15)
})

test(&quot;stale&quot;, function(t) {
  var cache = new LRU({
    maxAge: 10,
    stale: true
  })

  cache.set(&#039;foo&#039;, &#039;bar&#039;)
  t.equal(cache.get(&#039;foo&#039;), &#039;bar&#039;)
  t.equal(cache.has(&#039;foo&#039;), true)
  setTimeout(function() {
    t.equal(cache.has(&#039;foo&#039;), false)
    t.equal(cache.get(&#039;foo&#039;), &#039;bar&#039;)
    t.equal(cache.get(&#039;foo&#039;), undefined)
    t.end()
  }, 15)
})

test(&quot;lru update via set&quot;, function(t) {
  var cache = LRU({ max: 2 });

  cache.set(&#039;foo&#039;, 1);
  cache.set(&#039;bar&#039;, 2);
  cache.del(&#039;bar&#039;);
  cache.set(&#039;baz&#039;, 3);
  cache.set(&#039;qux&#039;, 4);

  t.equal(cache.get(&#039;foo&#039;), undefined)
  t.equal(cache.get(&#039;bar&#039;), undefined)
  t.equal(cache.get(&#039;baz&#039;), 3)
  t.equal(cache.get(&#039;qux&#039;), 4)
  t.end()
})

test(&quot;least recently set w/ peek&quot;, function (t) {
  var cache = new LRU(2)
  cache.set(&quot;a&quot;, &quot;A&quot;)
  cache.set(&quot;b&quot;, &quot;B&quot;)
  t.equal(cache.peek(&quot;a&quot;), &quot;A&quot;)
  cache.set(&quot;c&quot;, &quot;C&quot;)
  t.equal(cache.get(&quot;c&quot;), &quot;C&quot;)
  t.equal(cache.get(&quot;b&quot;), &quot;B&quot;)
  t.equal(cache.get(&quot;a&quot;), undefined)
  t.end()
})

test(&quot;pop the least used item&quot;, function (t) {
  var cache = new LRU(3)
  , last

  cache.set(&quot;a&quot;, &quot;A&quot;)
  cache.set(&quot;b&quot;, &quot;B&quot;)
  cache.set(&quot;c&quot;, &quot;C&quot;)

  t.equal(cache.length, 3)
  t.equal(cache.max, 3)

  // Ensure we pop a, c, b
  cache.get(&quot;b&quot;, &quot;B&quot;)

  last = cache.pop()
  t.equal(last.key, &quot;a&quot;)
  t.equal(last.value, &quot;A&quot;)
  t.equal(cache.length, 2)
  t.equal(cache.max, 3)

  last = cache.pop()
  t.equal(last.key, &quot;c&quot;)
  t.equal(last.value, &quot;C&quot;)
  t.equal(cache.length, 1)
  t.equal(cache.max, 3)

  last = cache.pop()
  t.equal(last.key, &quot;b&quot;)
  t.equal(last.value, &quot;B&quot;)
  t.equal(cache.length, 0)
  t.equal(cache.max, 3)

  last = cache.pop()
  t.equal(last, null)
  t.equal(cache.length, 0)
  t.equal(cache.max, 3)

  t.end()
})</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
